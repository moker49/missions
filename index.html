<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dice Throne Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:FILL,GRAD@1,200&icon_names=favorite,home,search,settings" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="tabs">
    <button class="tab-button active" onclick="showTab('perks')">Perks</button>
    <button class="tab-button" onclick="showTab('missions')">Missions</button>
  </div>
  <div id="perks" class="tab-content active">
    <div class="scroll-container">
      <div class="perk-list" id="perkGrid"></div>
    </div>
  </div>

  <div id="missions" class="tab-content">
    <div class="scroll-container">
      <div class="mission-list" id="missionGrid"></div>
    </div>
  </div>

  <script>
    const perkGrid = document.getElementById('perkGrid');
    const missionGrid = document.getElementById('missionGrid');

    const perkData = Array(5).fill().map(() => Array(5).fill(0));
    const missionPattern = [2, 5, 5, 4, 4];

    // PERKS
    const perkNames = [
      [
        { label: "Extra Roll", icons: ["home"] },
        { label: "Wild Boost", icons: ["home", "home"] },
        { label: "Regen Boost", icons: ["home"] },
        { label: "Damage Boost", icons: ["home"] },
        { label: "Shield", icons: ["home"] }
      ],
      [
        { label: "Pierce", icons: ["home"] },
        { label: "Crit", icons: ["home"] },
        { label: "Draw Boost", icons: ["home"] },
        { label: "Evasion", icons: ["home"] },
        { label: "Fortify", icons: ["home"] }
      ],
    ];

    const missionData = missionPattern.flatMap((count, diffIndex) =>
      Array(count).fill().map((_, i) => ({
        name: `D${diffIndex + 1} - Mission ${i + 1}`,
        stage: 0,
        boss: 0,
        perfect: false,
        difficulty: diffIndex + 1
      }))
    );

    // PERK GRID
    function renderPerkGrid() {
      perkGrid.innerHTML = '';
      for (let difficulty = 1; difficulty <= perkNames.length; difficulty++) {
        const section = document.createElement('div');
        section.className = 'perk-section';

        const header = document.createElement('div');
        header.className = 'perk-header';
        header.textContent = `Difficulty ${difficulty} `;
        section.appendChild(header);

        for (let perk = 0; perk < 5; perk++) {
          const row = document.createElement('div');
          row.className = 'perk-entry' + (perk % 2 === 1 ? ' alt' : '');

          const icon = document.createElement('div');
          icon.className = 'perk-icon';
          icon.innerHTML = '';
          perkNames[difficulty - 1][perk].icons.forEach(iconName => {
            const i = document.createElement('span');
            i.className = 'material-symbols-outlined';
            i.textContent = iconName;
            icon.appendChild(i);
          });


          const label = document.createElement('div');
          label.className = 'perk-label';
          label.textContent = perkNames[difficulty - 1][perk].label;

          const dots = document.createElement('div');
          dots.className = 'perk-dots';

          for (let i = 0; i < 4; i++) {
            const dot = document.createElement('div');
            dot.className = 'perk-dot';
            if (i < perkData[difficulty - 1][perk]) dot.classList.add('active');
            dots.appendChild(dot);
          }

          row.onclick = () => {
            perkData[difficulty - 1][perk] = (perkData[difficulty - 1][perk] + 1) % 5;
            renderPerkGrid();
          };

          row.appendChild(icon);
          row.appendChild(label);
          row.appendChild(dots);
          section.appendChild(row);
        }

        perkGrid.appendChild(section);
      }
    }

    // MISSION GRID
    function renderMissionGrid() {
      missionGrid.innerHTML = '';

      for (let d = 1; d <= 5; d++) {
        const section = document.createElement('div');
        section.className = 'mission-section';

        const header = document.createElement('div');
        header.className = 'mission-header';
        header.textContent = `Difficulty ${d}`;
        section.appendChild(header);

        const missions = missionData.filter(m => m.difficulty === d);
        missions.forEach((mission, index) => {
          const row = document.createElement('div');
          row.className = 'mission-entry' + (index % 2 === 1 ? ' alt' : '');

          const toggle = document.createElement('div');
          toggle.className = 'mission-toggle';
          if (mission.perfect) toggle.classList.add('active');
          toggle.textContent = mission.perfect ? '✅' : '▢';
          toggle.onclick = () => {
            mission.perfect = !mission.perfect;
            renderMissionGrid();
          };

          const label = document.createElement('div');
          label.className = 'mission-label';
          label.textContent = mission.name;

          const countContainer = document.createElement('div');
          countContainer.className = 'mission-count';

          const stage = document.createElement('div');
          stage.className = 'count-button count-stage';
          stage.textContent = mission.stage;
          stage.onclick = () => {
            mission.stage++;
            renderMissionGrid();
          };

          const boss = document.createElement('div');
          boss.className = 'count-button count-boss';
          boss.textContent = mission.boss;
          boss.onclick = () => {
            mission.boss++;
            renderMissionGrid();
          };

          countContainer.appendChild(stage);
          countContainer.appendChild(boss);

          row.appendChild(toggle);
          row.appendChild(label);
          row.appendChild(countContainer);

          section.appendChild(row);
        });

        missionGrid.appendChild(section);
      }
    }

    function showTab(id) {
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelector(`[onclick="showTab('${id}')"]`).classList.add('active');
      document.getElementById(id).classList.add('active');
    }

    try {
      renderPerkGrid();
      renderMissionGrid();
    } catch (e) {
      console.error("Render error:", e);
    }

  </script>
</body>
</html>
